{
  "AWSVersion": "2022-04-02",
  "Name": "S7 to OPC UA configured data model",
  "Version": 1,
  "LogLevel": "Info",
  "Schedules": [
    {
      "Name": "ConveyorData",
      "Interval": 1000,
      "Active": true,
      "TimestampLevel": "Both",
      "Sources": {
        "S7-SOURCE": [
          "*"
        ]
      },
      "Targets": [
        "#DebugTarget",
        "OpcuaTarget"
      ]
    }
  ],
  "Sources": {
    "S7-SOURCE": {
      "Name": "FluidConveyor",
      "ProtocolAdapter": "S7",
      "AdapterController": "S7-PLC-1",
      "Description": "S7 PLC local server",
      "Channels": {
        "Power": {
          "Address": "%DB120:230:DINT"
        },
        "Speed": {
          "Address": "%DB120:234:DINT"
        },
        "Temperature": {
          "Address": "%DB120:242:REAL",
          "Metadata": {
            "Unit": "Celsius"
          }
        },
        "Pressure": {
          "Address": "%DB120:246:REAL"
        },
        "Flow": {
          "Address": "%DB120:250:REAL"
        },
        "Torque": {
          "Address": "%DB120:254:REAL"
        }
      }
    }
  },
  "Targets": {
    "DebugTarget": {
      "TargetType": "DEBUG-TARGET"
    },
    "OpcuaTarget": {
      "LogLevel": "Info",
      "TargetType": "OPCUA-TARGET",
      "AutoCreate": false,
      "DataModels": {
        "ConveyorDataModel": {
          "DisplayName": "Conveyor DataModel",
          "Id" : 1000,
          "BrowseName" : "ConveyorDataModel",
          "Folders": {
            "DeviceData": {
              "Id" : 1001,
              "BrowseName" : "FluidPumpMotorData",
              "DisplayName": "Pump Motor Data",
              "Variables": {
                "MotorPower": {
                  "Id" : 1002,
                  "BrowseName" : "FluidPumpMotorPower",
                  "DisplayName": "Motor Power",
                  "DataType": "INT32",
                  "ValueQuery": "@.sources.FluidConveyor.values.Power.value"
                },
                "MotorSpeed": {
                  "Id" : 1003,
                  "BrowseName" : "FluidPumpMotorSpeed",
                  "DisplayName": "Motor RPM",
                  "DataType": "INT32",
                  "ValueQuery": "@.sources.FluidConveyor.values.Speed.value"
                },
                "MotorTorque": {
                  "Id" : 1004,
                  "BrowseName" : "FluidPumpMotorTorque",
                  "DisplayName": "Motor Torque",
                  "DataType": "REAL",
                  "ValueQuery": "@.sources.FluidConveyor.values.Torque.value"
                }
              },
              "Folders": {
                "MotorTemperature": {
                  "Id" : 1005,
                  "BrowseName" : "FluidPumpMotorTemperature",
                  "DisplayName": "Motor Temperature",
                  "Variables": {
                    "Value": {
                      "Id" : 1006,
                      "BrowseName" : "FluidPumpMotorTemperatureValue",
                      "DisplayName" : "Temperature",
                      "DataType": "INT",
                      "ValueQuery": "@.sources.FluidConveyor.values.Temperature.value",
                      "Transformation": "ToCelsius"
                    },
                    "Unit": {
                      "Id" : 1007,
                      "BrowseName" : "FluidPumpMotorTemperatureUnit",
                      "DisplayName" : "Unit",
                      "DataType": "STRING",
                      "ValueQuery": "@.sources.FluidConveyor.values.Temperature.metadata.Unit"
                    }
                  }
                }
              }
            },
            "PumpData": {
              "Id" : 1008,
              "BrowseName" : "FluidPumpMotorPumpData",
              "DisplayName": "Pump Data",
              "Variables": {
                "PumpFlow": {
                  "Id" : 1009,
                  "BrowseName" : "FluidPumpMotorPumpFlow",
                  "DisplayName": "Pump Flow",
                  "DataType": "REAL",
                  "ValueQuery": "@.sources.FluidConveyor.values.Flow.value"
                },
                "PumpPressure": {
                  "Id" : 1010,
                  "BrowseName" : "FluidPumpMotorPumpPressure",
                  "DisplayName": "Pump Pressure",
                  "DataType": "REAL",
                  "ValueQuery": "@.sources.FluidConveyor.values.Pressure.value"
                }
              }
            }
          }
        }
      }
    }
  },
  "TargetTypes": {
    "DEBUG-TARGET": {
      "JarFiles": [
        "${SFC_DEPLOYMENT_DIR}/debug-target/lib"
      ],
      "FactoryClassName": "com.amazonaws.sfc.debugtarget.DebugTargetWriter"
    },
    "OPCUA-TARGET": {
      "JarFiles": [
        "${SFC_DEPLOYMENT_DIR}/opcua-target/lib"
      ],
      "FactoryClassName": "com.amazonaws.sfc.opcuatarget.OpcuaTargetWriter"
    }
  },
  "AdapterTypes": {
    "S7": {
      "JarFiles": [
        "${SFC_DEPLOYMENT_DIR}/s7/lib"
      ],
      "FactoryClassName": "com.amazonaws.sfc.s7.S7Adapter"
    }
  },
  "ProtocolAdapters": {
    "S7": {
      "AdapterType": "S7",
      "Controllers": {
        "S7-PLC-1": {
          "Address": "192.168.1.130",
          "ReadPerSingleField": false,
          "LocalRack": 0,
          "LocalSlot": 1,
          "RemoteRack": 0,
          "RemoteSlot": 1,
          "PduSize": 1024,
          "MaxAmqCaller": 8,
          "MaxAmqCallee": 8,
          "ControllerType": "S7-1200",
          "ReadTimeout": 10000,
          "ConnectTimeout": 10000
        }
      }
    }
  },
  "Transformations" :{
    "ToCelsius" : [
      { "Operator" : "Celsius"},
      { "Operator" : "ToInt"}

    ]
  }
}