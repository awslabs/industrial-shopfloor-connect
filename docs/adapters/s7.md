# S7 Protocol Configuration

 The AWS IoT SiteWise Connector (SFC) S7 connector enables reading data from Siemens PLCs using the native S7 communication protocol (S7Comm). It provides direct connectivity to Siemens S7-300, S7-400, S7-1200, and S7-1500 series PLCs, allowing you to collect data points from various memory areas of the PLC. The connector handles the complexities of the S7 protocol while providing a simple configuration interface for data collection and forwarding to AWS services

For S7 communication:

- The adapter can only read from non-optimized data blocks in S7-1200/1500 PLCs - optimized blocks are not accessible.

- PUT/GET communication must be explicitly enabled in the PLC hardware configuration settings.

- To enable PUT/GET: Open TIA Portal -> PLC Security Settings -> Connection mechanisms -> Enable "Access with PUT/GET..." option

  

In order to use this adapter as in [in-process](../sfc-running-adapters.md#running-protocol-adapters-in-process) type adapter the type must be added to the [AdapterTypes](../core/sfc-configuration.md#adaptertypes) section in the [SFC configuration file](../core/sfc-configuration.md).

```json
"AdapterTypes" :{
  "S7" : {
    "JarFiles" : ["<location of deployment>/s7/lib"]
  },
  "FactoryClassName" : "com.amazonaws.sfc.s7.S7Adapter"
}
```

**Configuration:**

- [S7SourceConfiguration](#s7sourceconfiguration)
- [S7FieldChannelConfiguration](#s7fieldchannelconfiguration)
- [S7ControllerConfiguration](#s7controllerconfiguration)

---

## S7SourceConfiguration

[SFC Configuration](../core/sfc-configuration.md) > [Sources](../core/sfc-configuration.md#sources) >  [Source](../core/source-configuration.md) 

The S7SourceConfiguration class defines which channels (data points) to read from a specific S7 PLC and specifies which of the configured S7 controllers in the adapter configuration should be used for the communication

Source configuration for the S7 protocol adapter. This type extends the [SourceConfiguration](../core/source-configuration.md) type.

- [Schema](#s7sourceconfiguration-schema)
- [Examples](#s7sourceconfiguration-examples)

**Properties:**
- [AdapterController](#adaptercontroller)
- [Channels](#channels)

  

---
### AdapterController
The AdapterController property specifies the identifier of the S7 PLC controller to use for communication. This identifier must match one of the controllers defined in the Controllers section of the S7 adapter configuration referenced by the source's ProtocolAdapter attribute.

**Type**: String

---
### Channels
The Channels property defines a map of channel configurations for reading values from the S7 PLC, where each channel is identified by a unique name. Individual channels can be disabled by prefixing their identifier with a "#" character.

**Type**: Map[String,[S7FieldChannelConfiguration](#s7fieldchannelconfiguration)]

At least 1 channel must be configured.

### S7SourceConfiguration Schema

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "description": "Configuration for S7 source",
  "allOf": [
    {
      "$ref": "#/definitions/SourceConfiguration"
    },
    {
      "type": "object",
      "properties": {
        "AdapterController": {
          "type": "string",
          "description": "Reference to the S7 controller configuration in the adapter"
        },
        "Channels": {
          "type": "object",
          "description": "Map of S7 field channel configurations",
          "additionalProperties": {
            "$ref": "#/definitions/S7FieldChannelConfiguration"
          },
          "minProperties": 1
        }
      },
      "required": ["AdapterController", "Channels"]
    }
  ]
}
```

### S7SourceConfiguration Examples

```json
{
  "Name": "ProductionLine1",
  "ProtocolAdapter" : "S7Adapter"
  "AdapterController": "MainPLC",
  "Channels": {
    "ProductCount": {
      "Name": "counter",
      "Address": "DB100.DBW0",
      "Type": "Int",
      "Description": "Daily production counter"
    },
    "MachineStatus": {
      "Name": "status",
      "Address": "DB100.DBX2.0",
      "Type": "Bool",
      "Description": "Machine running status"
    }
  }
}

```


[^top](#s7-protocol-configuration)



## S7FieldChannelConfiguration

[SFC Configuration](../core/sfc-configuration.md) > [Sources](../core/sfc-configuration.md#sources) > [Source](../core/source-configuration.md)  > [Channels](../core/source-configuration.md#channels) > [Channel](../core/channel-configuration.md)

The S7FieldChannelConfiguration class extends  [ChannelConfiguration](../core/channel-configuration.md)  with specific properties needed for reading data points from S7 PLCs, including the memory address and data type of the PLC field to be read

- [Schema](#s7fieldchannelconfiguration-schema)
- [Examples](#s7fieldchannelconfiguration-examples)

**Properties:**
- [Address](#address)

---
### Address
The Address property specifies the location in PLC memory to read data from, using either TIA Portal format  or PLC4J format. The address must match the exact memory location and data type as configured in the PLC.

**Type**: String

Address of the fields to read in the same format as used in TIA portal.
`%{Memory-Area}{start-address}:{Data-Type}[{array-size}]`

For reading from Global Memory blocks, the block must be configured as non-optimized. Additionally, the size of the data (length of the string or array size) must precisely match the sizes used in the controller. If a string's length is not specified, the default length of 254 characters is used. Furthermore, arrays' indices are zero-based.

The shorter syntax for addresses as used by PLC4J are also supported

- `DB{Data-Block-Number}:{Start-Byte-Address}.{Bit-Offset}:BOOL[{Count}] DB{Data-Block-Number}:{Start-Byte-Address}:{Data-Type-Code}[{Count}]` 
- `DB{Data-Block-Number}:{Start-Byte-Address}:STRING({string-length})[{Count}]`

The TIME data type values are returned as a string in ISO-8601 duration format. IsoTimeStrToSeconds, IsoTimeStrToMilliSeconds and IsoTimeStrToNanoSeconds transformation operators to convert the string to the numeric value.

The DATE type values are returned as a time string in the format yyyy-mm-dd

The TIME_OF_DAY type values are returned as strings in the format hh:mm:ss

BYTE, WORD, DWORD and LWORD type values are returned as an of 8, 16, 32 and 64 Boolean values

### S7FieldChannelConfiguration Schema

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "S7FieldChannelConfiguration",
  "description": "Configuration for an S7 field channel",
  "properties": {
    "Address": {
      "type": "string",
      "description": "The S7 field address"
    }
  },
  "required": ["Address"]
}

```

### S7FieldChannelConfiguration Examples

```json
{
   "Address": "%DB120:242:REAL",
   "Metadata" :{
      "Unit" : "Celsius"
   }
}
```

[^top](#s7-protocol-configuration)



## S7AdapterConfiguration

[SFC Configuration](../core/sfc-configuration.md) > [ProtocolAdapters](../core/sfc-configuration.md#protocoladapters) > [Adapter](../core/protocol-adapter-configuration.md) 

The S7AdapterConfiguration class defines the configuration for an S7 protocol adapter, including the collection of S7 PLC controllers that can be used by S7 sources. Each controller in the configuration specifies connection parameters for a specific PLC that can be referenced by sources using the [AdapterController](#adaptercontroller) property.

S7AdapterConfiguration extension the [AdapterConfiguration](../core/protocol-adapter-configuration.md) with properties for the S7 Protocol adapter.

- [Schema](#s7adapterconfiguration-schema)
- [Examples](#s7adapterconfiguration-examples)

**Properties:**

- [Controllers](#controllers)
- [WaitAfterErrors](#waitaftererrors)

---
### Controllers
PLCs servers configured for this adapter. The S7 source using the adapter must have a reference to one of these in its [AdapterController](#adaptercontroller)  attribute.

**Type**: Map[String,[S7ControllerConfiguration](#s7controllerconfiguration)]

---
### WaitAfterErrors
The WaitAfterErrors property specifies the delay in milliseconds before attempting to read from the PLC again after encountering a read or connection error. If not specified, it defaults to 10000 milliseconds (10 seconds).

**Type**: Integer

### S7AdapterConfiguration Schema

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "description": "Configuration for S7 adapter",
  "allOf": [
    {
      "$ref": "#/definitions/AdapterConfiguration"
    },
    {
      "type": "object",
      "properties": {
        "Controllers": {
          "type": "object",
          "description": "Map of S7 controller configurations",
          "additionalProperties": {
            "$ref": "#/definitions/S7ControllerConfiguration"
          },
          "minProperties": 1
        },
        "WaitAfterErrors": {
          "type": "integer",
          "description": "Time to wait after errors in milliseconds"
        }
      },
      "required": [
        "Controllers"
      ]
    }
  ]
}
```

### S7AdapterConfiguration Examples

 Basic single controller:

```json
{
  "AdapterType" : "S7AdapterType",
  "Controllers": {
    "MainPLC": {
      "Address": "192.168.1.100",
      "Rack": 0,
      "Slot": 2,
      "ConnectionTimeout": 5000
    }
  },
  "WaitAfterErrors": 5000
}
```



Example 2 - Multiple controllers:

```json
{
  "AdapterType" : "S7AdapterType",
  "Controllers": {
    "ProductionPLC": {
      "Address": "192.168.1.101",
      "Rack": 0,
      "Slot": 2,
      "ConnectionTimeout": 10000,
      "ReadTimeout": 5000
    },
    "PackagingPLC": {
      "Address": "192.168.1.102",
      "Rack": 0,
      "Slot": 3,
      "ConnectionTimeout": 10000,
      "ReadTimeout": 5000
    }
  },
  "WaitAfterErrors": 10000
}
```



[^top](#s7-protocol-configuration)



## S7ControllerConfiguration

[S7Adapter](#s7adapterconfiguration) > [Controllers](#controllers)

The S7ControllerConfiguration class defines the connection parameters needed to establish communication with a specific S7 PLC.

- [Schema](#s7controllerconfiguration-schema)
- [Examples](#s7controllerconfiguration-examples)

**Properties:**

- [Address](#address)
- [ConnectTimeout](#connecttimeout)
- [ControllerType](#controllertype)
- [LocalRack](#localrack)
- [LocalSlot](#localSlot)
- [MaxAmqCallee](#maxamqcallee)
- [MaxAmqCaller](#maxamqcaller)
- [MaxPduSize](#maxpdusize)
- [ReadPerSingleField](#readpersinglefield)
- [ReadTimeout](#readtimeout)
- [RemoteRack](#remoterack)
- [RemoteSlot](#remoteslot)

---
### Address
The Address property specifies the IP address of the S7 PLC to connect to, using standard IPv4 format (aaa.bbb.ccc.ddd). The "s7://" prefix is optional.

**Type**: String

---
### ConnectTimeout
The ConnectTimeout property defines the maximum time (in milliseconds) to wait when attempting to establish a connection with the S7 PLC. If the connection isn't established within this time, a timeout error occurs. If not specified, it defaults to 10000 milliseconds (10 seconds).

**Type**: Integer

Default is 10000

---
### ControllerType
The PLC4J S7 driver normally identifies the type of PLC as part of the connection process. As for some devices this can cause hang up or other problems, the type can be set to skip the identification process.

**Type**: String

Supported PLC types:

- "S7-1200"
- "S7-1500"
- "S7-300" (PLC4J supported but not verified)
- "S7-400" (PLC4J supported but not verified)
- "LOGO" (PLC4J supported but not verified)

---
### LocalRack
The LocalRack property specifies the rack number where the PLC CPU is installed. If not specified, it defaults to 1.

**Type**: Integer

---
### LocalSlot
The LocalSlot property specifies the slot number where the PLC CPU is installed in the rack. If not specified, it defaults to 1.

**Type**: Integer

Default is 1

---
### MaxAmqCallee
The MaxAmqCallee property sets the maximum number of concurrent calls the adapter will accept from the PLC. The actual limit used will be the lower value between this setting and the MaxAmqCaller value negotiated with the PLC. If not specified, it defaults to 8 concurrent calls.

MaxAmqCallee controls how many concurrent calls the adapter will accept FROM the PLC, while [MaxAmqCaller](#maxamqcaller) controls how many parallel calls the adapter can make TO the PLC.

**Type**: Integer

---
### MaxAmqCaller
The MaxAmqCaller property sets the maximum number of parallel calls that can be made to the PLC. The actual limit is determined through negotiation during the connection process with the PLC. If not specified, it defaults to 8 parallel calls.

MaxAmqCaller controls how many parallel calls the adapter can make TO the PLC, while [MaxAmqCallee](#maxamqcallee) controls how many concurrent calls the adapter will accept FROM the PLC.

**Type**: Integer

---
### MaxPduSize
The MaxPduSize property defines the maximum size (in bytes) of Protocol Data Units (PDUs) that can be exchanged with the PLC. The actual PDU size used is determined through negotiation during the connection process with the PLC.

Here are the typical PDU (Protocol Data Unit) sizes for different S7 PLC types:

- S7-200: 240 bytes
- S7-300: 240 bytes
- S7-400: 480 bytes
- S7-1200: 240 bytes
- S7-1500: 960 bytes

The actual PDU size used will be negotiated during connection, but will not exceed these hardware-specific limits.

**Type**: 

Default is 1024



---
### ReadPerSingleField
The ReadPerSingleField property is a debugging flag that controls how fields are read from the PLC:

- When false (recommended for normal operation):
  - Fields are combined up to the MaxPduSize to minimize PLC read operations
  - More efficient performance
  - If one field fails in a combined read, the entire set fails
- When true (debugging mode):
  - Each field is read individually
  - Helps identify specific problematic fields
  - Significantly more read operations
  - Lower performance

**Type**: Boolean

Default is false

---
### ReadTimeout
The ReadTimeout property specifies the maximum time (in milliseconds) to wait for a response when reading data from the PLC. If the PLC doesn't respond within this time, the read operation will fail with a timeout error.

**Type**: Integer

Default is 1000

---
### RemoteRack
The RemoteRack property specifies the rack number where the remote PLC is installed. If not specified, it defaults to 0. This is used when communicating with a remote PLC through a gateway or network interface.

This is different from the regular Rack property which is used for direct PLC connections. RemoteRack is specifically for scenarios where you're communicating with a PLC through an intermediate device or network

**Type**: Integer

---
### RemoteSlot
The RemoteSlot property specifies the slot number where the remote PLC CPU module is installed within its rack. If not specified, it defaults to 0. This is used when communicating with a remote PLC through a gateway or network interface.

This is different from the regular Slot property which is used for direct PLC connections. RemoteSlot is specifically for scenarios where you're communicating with a PLC through an intermediate device or network

**Type**: 

Default is 0
### S7ControllerConfiguration Schema

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "description": "Configuration for PCCC channel",
  "properties": {
    "Address": {
      "type": "string",
      "description": "PCCC address for the channel"
    },
    "ConnectTimeout": {
      "type": "integer",
      "description": "Connection timeout in milliseconds"
    },
    "ControllerType": {
      "type": "string",
      "description": "Type of the PCCC controller"
    },
    "LocalRack": {
      "type": "integer",
      "description": "Local rack number"
    },
    "LocalSlot": {
      "type": "integer",
      "description": "Local slot number"
    },
    "MaxAmqCallee": {
      "type": "integer",
      "description": "Maximum AMQ callee value"
    },
    "MaxAmqCaller": {
      "type": "integer",
      "description": "Maximum AMQ caller value"
    },
    "MaxPduSize": {
      "type": "integer",
      "description": "Maximum PDU size"
    },
    "ReadPerSingleField": {
      "type": "boolean",
      "description": "Flag to indicate if reading should be done per single field"
    },
    "ReadTimeout": {
      "type": "integer",
      "description": "Read operation timeout in milliseconds"
    },
    "RemoteRack": {
      "type": "integer",
      "description": "Remote rack number"
    },
    "RemoteSlot": {
      "type": "integer",
      "description": "Remote slot number"
    }
  },
  "required": ["Address"]
}

```

### S7ControllerConfiguration Examples

Minimal configuration:

```json
{
  "Address": "N7:0"
}
```

Basic configuration with timeouts:

```json
{
  "Address": "B3:0",
  "ConnectTimeout": 5000,
  "ReadTimeout": 3000
}
```

Full rack and slot configuration:

```json
{
  "Address": "F8:0",
  "LocalRack": 0,
  "LocalSlot": 1,
  "RemoteRack": 2,
  "RemoteSlot": 3
}
```



[^top](#s7-protocol-configuration)

